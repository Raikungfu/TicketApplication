@model List<Order>
@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success">
        @TempData["SuccessMessage"]
    </div>
}

<!-- Display error message if it exists -->
@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger">
        @TempData["ErrorMessage"]
    </div>
}

<div class="order-history">
    <h2>Order History</h2>
    @foreach (var order in Model)
    {
        <div class="order-item" onclick="getOrderDetails(@order.Id)">
            <strong>Order ID:</strong> @order.Id <br>
            <strong>Date:</strong> @order.CreatedAt <br>
            <strong>Status:</strong> @order.Status
            <div id="details-@order.Id" class="order-details" style="display: none;"></div>
        </div>
    }
</div>

@section Scripts {
    <script>
        function getOrderDetails(orderId) {
            const detailsDiv = $('#details-' + orderId);
            if (detailsDiv.is(':empty')) {
                $.ajax({
                    url: '/Order/GetOrderDetails',
                    type: 'GET',
                    data: { orderId: orderId },
                    success: function (result) {
                        detailsDiv.html(result);
                        detailsDiv.show();
                    },
                    error: function () {
                        alert('Error retrieving order details.');
                    }
                });
            } else {
                detailsDiv.toggle();
            }
        }
    </script>
}
